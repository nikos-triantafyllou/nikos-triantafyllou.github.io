<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>21cm Lightcone Viewer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <!-- MathJax for LaTeX rendering -->
  <script type="text/javascript" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>

  <style>
    :root {
      --bg-color: #f5f7fa;
      --text-color: #333;
      --card-bg: #ffffff;
      --button-bg: #e0e7ff;
      --button-hover: #c7d2fe;
    }

    body.dark {
      --bg-color: #1e1e1e;
      --text-color: #f0f0f0;
      --card-bg: #2a2a2a;
      --button-bg: #444;
      --button-hover: #666;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: var(--card-bg);
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    header h2 {
      font-size: 1.8rem;
      margin: 0;
    }

    #toggle-theme {
      background: var(--button-bg);
      color: var(--text-color);
      border: none;
      padding: 8px 14px;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }

    #toggle-theme:hover {
      background: var(--button-hover);
    }

    #main-image {
      width: 100%;
      max-width: 1000px;
      margin: 30px auto 20px;
      display: block;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 1000px;
      margin: 0 auto 40px;
      padding: 10px;
    }

    .param-group {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 10px 16px;
      margin: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      min-width: 160px;
      text-align: center;
    }

    .param-label {
      font-weight: 500;
      margin-bottom: 8px;
      display: block;
      font-size: 0.95rem;
    }

    .buttons button {
      width: 36px;
      height: 36px;
      margin: 0 4px;
      font-size: 1.2rem;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      background: var(--button-bg);
      color: var(--text-color);
      transition: background 0.2s, color 0.2s;
    }

    .buttons .plus:hover {
      background-color: #d1f7d1;
      color: #1e5e1e;
    }

    .buttons .minus:hover {
      background-color: #fbd1d1;
      color: #8a1d1d;
    }

    .buttons {
      display: flex;
      justify-content: center;
    }
  </style>
</head>
<body>

<header>
  <h2>21cm Lightcone Viewer</h2>
  <button id="toggle-theme">üåô Dark Mode</button>
</header>

<img id="main-image" src="img/id_21.png" alt="21cm plot">

<div id="controls"></div>

<script>
  const xnames = [
    '\\(\\sigma_8\\)',
    '\\(\\log_{10}(L_{\\text{X}<2\\text{keV}} / \\text{SFR})\\)<br>\\(\\text{[erg s}^{-1} M_\\odot^{-1} \\text{yr}^{-1}]\\)',
    '\\(E_0\\;[\\text{eV}]\\)',
    '\\(\\log_{10}(f_{\\ast,10})\\)',
    '\\(\\alpha_\\ast\\)',
    '\\(\\log_{10}(f_{\\text{esc},10})\\)',
    '\\(\\alpha_{\\text{esc}}\\)',
    '\\(t_\\ast\\)',
    '\\(\\sigma_{\\text{SFR,LIM}}\\)',
    '\\(\\log_{10}(M_{\\text{turn}} / M_\\odot)\\)'
  ];

  const paramToId = i => [22 + i * 2, 23 + i * 2];
  let paramValues = Array(10).fill(0);

  function updateImage() {
    let active = paramValues.findIndex(v => v !== 0);
    let imgId = 21;
    if (active !== -1) {
      imgId = paramValues[active] === -1 ? paramToId(active)[0] : paramToId(active)[1];
    }
    document.getElementById('main-image').src = `img/id_${imgId}.png`;
  }

  function resetAll() {
    paramValues = Array(10).fill(0);
    document.querySelectorAll('.param-label').forEach((el, i) => {
      el.innerHTML = `${xnames[i]}: 0`;
    });
    MathJax.typesetPromise();
    updateImage();
  }

  function createControls() {
    const controlsDiv = document.getElementById('controls');
    xnames.forEach((latex, i) => {
      const group = document.createElement('div');
      group.className = 'param-group';

      const label = document.createElement('div');
      label.className = 'param-label';
      label.innerHTML = `${latex}: 0`;

      const minusBtn = document.createElement('button');
      minusBtn.innerText = '‚àí';
      minusBtn.className = 'minus';

      const resetBtn = document.createElement('button');
      resetBtn.innerText = '‚≠ò';
      resetBtn.className = 'reset';

      const plusBtn = document.createElement('button');
      plusBtn.innerText = '+';
      plusBtn.className = 'plus';

      minusBtn.onclick = () => {
        resetAll();
        paramValues[i] = -1;
        label.innerHTML = `${latex}: ‚àí`;
        MathJax.typesetPromise();
        updateImage();
      };

      resetBtn.onclick = () => {
        paramValues[i] = 0;
        label.innerHTML = `${latex}: 0`;
        MathJax.typesetPromise();
        updateImage();
      };

      plusBtn.onclick = () => {
        resetAll();
        paramValues[i] = 1;
        label.innerHTML = `${latex}: +`;
        MathJax.typesetPromise();
        updateImage();
      };

      const btnBox = document.createElement('div');
      btnBox.className = 'buttons';
      btnBox.append(minusBtn, resetBtn, plusBtn);

      group.append(label, btnBox);
      controlsDiv.appendChild(group);
    });

    MathJax.typesetPromise();
  }

  function toggleTheme() {
    const body = document.body;
    const btn = document.getElementById('toggle-theme');
    body.classList.toggle('dark');
    btn.innerText = body.classList.contains('dark') ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  }

  document.getElementById('toggle-theme').addEventListener('click', toggleTheme);

  createControls();
</script>

</body>
</html>
